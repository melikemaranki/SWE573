{% extends "users/base_generic.html" %}
{% block content %}
<br></br>
   <h3>Welcome {{ user.username }}!</h3>
   <br></br>
   <form action="{% url 'fetchData' %}" method="POST">
    {% csrf_token %}
      <input name="search" type="text" name="name_field" placeholder="Search keywords.">
      <input type="submit">
  </form>
  {% if search %}
   <h3>For keyword: {{search}} with search_id:{{search_id}} -> data is fetched. Click the 'Analyze Data' below to see the analysis of your choice!</h3>
   {% endif %}

<p>View last 5 searches</p>

<form action="{% url 'showChart_with_ID' %}">
  <label>Choose a saved search:</label>
  <select name="id" id="table_list">
    <option value="1">id: 1 - keyword: covid - date: 30.01.2021 </option>
    <option value="1">id: 2 - keyword: netflix - date: 30.01.2021 </option>
    {% for item in q_res %}
    <option value="{{ item.search_id }}">id: {{item.search_id }} - keyword: {{item.search_keyword}} -  date: {{item.query_datetime}}</option>
    {% endfor %}
  </select>
  <input type="submit" value="Submit">
</form>

<br></br>

   <form action="{% url 'showChart' %}" method='POST'>
    {% csrf_token %}
    <button type='submit'> Analyze Data</button>
    </form>
  
    <br></br>
<div class="tab">
  <button class="tablinks" onclick="openTab(event, 'Top30')">Top30</button>
  <button class="tablinks" onclick="openTab(event, 'Wordcloud')">Wordcloud</button>
  <button class="tablinks" onclick="openTab(event, 'Network')">Network</button>
</div>

<div id="Top30" class="tabcontent">
  {% if s_test %}
  <h3> For search id: {{s_test}}, total number of tweets: {{count}}</h3>
  {% endif %}
  <p>
     {% if chart %}
     <img src="data:image/png;base64, {{chart|safe}}">
     {% endif %}
   </p>
</div>

{% if wcloud %}
<div id="Wordcloud" class="tabcontent">
  {% if s_test %}
  <h3>Wordcloud id: {{s_test}} total # of tweets collected: {{count}}</h3>
  {% endif %}
  <p>
     <img src="data:image/png;base64, {{wcloud|safe}}">
  </p> 
</div>
{% endif %}

{% if network %}
<div id="Network" class="tabcontent">
  {% if s_test %}
  <h3>Network id: {{s_test}} total # of tweets collected: {{count}}</h3>
  {% endif %}
  <p>
     <img src="data:image/png;base64, {{network|safe}}">
  </p> 
</div>
{% endif %}

<script>
function openTab(evt, tabName) {
  var i, tabcontent, tablinks;
  tabcontent = document.getElementsByClassName("tabcontent");
  for (i = 0; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";
  }
  tablinks = document.getElementsByClassName("tablinks");
  for (i = 0; i < tablinks.length; i++) {
    tablinks[i].className = tablinks[i].className.replace(" active", "");
  }
  document.getElementById(tabName).style.display = "block";
  evt.currentTarget.className += " active";
}
</script>   

<style>
  body {font-family: Arial;}
  
  /* Style the tab */
  .tab {
    overflow: hidden;
    border: 1px solid #ccc;
    background-color: #f1f1f1;
  }
  
  /* Style the buttons inside the tab */
  .tab button {
    background-color:#ccc;
    float: left;
    border: .5px solid;
    outline: none;
    cursor: pointer;
    padding: 14px 16px;
    transition: 0.3s;
    font-size: 17px;
  }
  
  /* Change background color of buttons on hover */
  .tab button:hover {
    background-color:blue;
  }
  
  /* Create an active/current tablink class */
  .tab button.active {
    background-color: #ccc;
  }
  </style>  

{% endblock content %}

{% block sidebar %}
<br></br>
<ul class="sidebar-nav">
  <li><a href="https://github.com/melikemaranki/SWE573/wiki" target= '_blank'>Project Wiki</a></li>
<li><a class='nav-item nav-link' href="{%url 'logout' %}">Logout</a></li>
</ul>
{% endblock %}